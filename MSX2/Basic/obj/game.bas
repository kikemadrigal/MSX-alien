10definta-z
20defusr=&h003B:a=usr(0):defusr1=&h003E:a=usr1(0):defusr2=&H90:a=usr2(0)
20defusr3=&H41:defusr4=&H44
100 print #1, "Cargando mapa en array (en RAM)"
110gosub13000:gosub13100
130gosub10200
140gosub11000
150gosub12000
160gosub20100
520strig(0)on:onstriggosub10500
550gosub14000
560gosub13300
570gosub10100
580gosub10000
2000gosub6000
2020gosub8000
2040gosub9000
2050gosub10140
2060'gosub3000
2090goto2000
3000preset(10,30):print#1,"p1"p1"t0"t0
3090return
6000onstick(0)gosub6200,6400,6600,6800,7000,7200,7400,7600
6190return
6200ifpa<>1thenpo=py:pa=1
6290return
6400ifpa<>1thenpo=py:pa=1
6410px=px+pv
6430swapp1,p2
6490return
6600px=px+pv
6610pd=3
6630swapp1,p2
6690return
6800'nada'
6890return
7000'nada'
7090return
7200'nada'
7290return
7400px=px-pv
7410pd=7
7440swapp3,p4
7490return
7600ifpa<>1thenpo=py:pa=1
7610px=px-pv
7630swapp3,p4
7690return
8000'Player'
    8010 if mc>=200-32 then print #1,"FINAL": return
8040ifpx>255thenputsprite0,(0,212),,p1:gosub13600:py=18*8:px=0:gosub12700:ms=ms+1:gosub13800:gosub10000
8020ifpx<0thenpx=0
8030ifpy>180thengoto10400
8050tx=px/8+mc:ty=py/8:ifpx<=0thentx=0:ifpy<=0thenty=0
8055t0=m(tx,ty+1)
8056ift0<26thenm(tx,ty+1)=tw:copy((tw-64)*8,2*8)-(((tw-64)*8)+8,(2*8)+8),1to(px-4,py+8),0:wc=wc-1:gosub10000
8060t3=m(tx+1,ty+1)
8070t5=m(tx,ty+2)
8080t7=m(tx,ty+1)
8090ift3>=tfandpa=0thenpx=px-pvelseift7>=tfandpa=0thenpx=px+pv
8110ifpa=1andt5>=tfandpl<0thenpa=0:pl=-pl
8120ifpa=1thenpy=py-pl
8130ifpa=1andpy<po-16thenpl=-pl
8140ifpa=1andpy>pothenpy=po:pl=-pl:pa=0
8150ifpa=0andt5<tfthenpy=py+pl
8290return
9000ifpd=3orpd=1orpd=2thenputsprite0,(px,py),,p1
9020ifpd=7thenputsprite0,(px,py),,p3
9100gosub11700
9200ifen<=0thenreturn
9210fori=1toen
9220ex(i)=ex(i)+ev(i)
9230ifex(i)mod5=0thenev(i)=-ev(i)
9235ifev(i)>0thenes(i)=es(i)+1elsees(i)=es
9240putspriteep(i),(ex(i),ey(i)),ec(i),es(i)
9250ifpx<ex(i)+16andpx+16>ex(i)andpy<ey(i)+16and16+py>ey(i)thengosub10400
9260forw=1todn
9270ifdx(w)<ex(i)+16anddx(w)+dw>ex(i)anddy(w)<ey(i)+16anddy(w)+dh>ey(i)thened=i:gosub12600:dd=w:gosub11600
9280nextw
9290nexti
9990return
10000line(0,184)-(256,212),1,bf
    10010 preset (10,190):print #1,"Capturas que faltan: "wc
10020preset(10,200):print#1,"Vidas:"pv"Level:"mu"-"ms
10030'preset(10,208):print#1,"libre:"fre(0)
10090return
10100wg=8:j=0
10120return
10140'ifmu=1then
10150return
10200px=16:py=13*8:pw=16:ph=16:pv=4:pl=8:pj=0:pa=0:dimj(7):po=0:pd=3
10210j(0)=-8:j(1)=-8:j(2)=-8:j(3)=0:j(4)=8:j(5)=8:j(6)=8
10220t1=0:t3=0:t5=0:t7=0
10230p1=0:p2=1:p3=2:p4=3
10240pp=0:ps=0
10250pe=100
10290return
10400py=18*8:px=0
10410'restar1vida'
10490return
10500beep:'re=5:gosub4300
10510gosub11500
10590return
11000dm=3:dn=0:dd=0:ds=6:dc=6:dp=0:dw=8:dh=2
11010DIMdx(dm),dy(dm),dv(dm),dp(dm)
11060return
11500ifdn>=dmthenreturnelsedn=dn+1
11510dx(dn)=px+8:dy(dn)=py+8
11530dv(dn)=8
11540ds(dn)=ds:dp(dn)=dp+dn
11580return
11600putspritedp(dd),(0,212),dc,ds(dd)
11610dx(dd)=dx(dn):dy(dd)=dy(dn):dv(dd)=dv(dn):ds(dd)=ds(dn):dp(dd)=dp(dn)
11650dn=dn-1
11690return
11700ifdn<=0thenreturn
11710fori=1todn
11720dx(i)=dx(i)+dv(i)
11730putspritedp(i),(dx(i),dy(i)),dc,ds(i)
11740ifdx(i)>256-16thendd=i:gosub11600
11750nexti
11790return
12000em=3:en=0:es=11
12010DIMex(em),ey(em),ev(em),el(em),es(em),ep(em),ec(em),ee(em)
12030return
12500ifen>=emthenreturnelseen=en+1
12510ex(en)=0:ey(en)=0
12530ev(en)=8:el(en)=8
12540es(en)=10:ep(en)=9+en
12550ec(en)=6
12560ee(en)=100
12590return
12600ifen<=0thenreturn
12600ex(ed)=ex(en):ey(ed)=ey(en):ev(ed)=ev(en):el(ed)=el(en):es(ed)=es(en):ep(ed)=ep(en):ec(ed)=ec(en):ee(ed)=ee(en)
12610putspriteep(ed),(0,212),ec(ed),es(ed)
12650en=en-1
12660return
12700en=0
12790return
    13000 print #1, "Pintando mapa"
13010dimm(200,26):mc=0:mu=0:ms=0
13020return
13100'estoalmacenaráelarrayapartirdelaposición8dc8delaRAM'
13110ifmu=0thenbload"world0.bin",r:gosub20000
13120md=&hc001
13130forf=0to23-1
13140forc=0to200-1
13150tn=peek(md):md=md+1
13160m(c,f)=tn
13170nextc
13180nextf
13190return
13300_turboon(m())
13310forf=0to23-1
13360forc=0to32-1
13370tn=m(c,f)
13380iftn>=0andtn<32thencopy(tn*8,0*8)-((tn*8)+8,(0*8)+8),1to(c*8,f*8),0,tpset
13390iftn>=32andtn<64thencopy((tn-32)*8,1*8)-(((tn-32)*8)+8,(1*8)+8),1to(c*8,f*8),0,tpset
13400iftn>=64andtn<96thencopy((tn-64)*8,2*8)-(((tn-64)*8)+8,(2*8)+8),1to(c*8,f*8),0,tpset
13410iftn>=96andtn<128thencopy((tn-96)*8,3*8)-(((tn-96)*8)+8,(3*8)+8),1to(c*8,f*8),0,tpset
13420iftn>=128andtn<160thencopy((tn-128)*8,4*8)-(((tn-128)*8)+8,(4*8)+8),1to(c*8,f*8),0,tpset
13430iftn>=160andtn<192thencopy((tn-160)*8,5*8)-(((tn-160)*8)+8,(5*8)+8),1to(c*8,f*8),0,tpset
13440iftn>=192andtn<224thencopy((tn-192)*8,6*8)-(((tn-192)*8)+8,(6*8)+8),1to(c*8,f*8),0,tpset
13450iftn>=224andtn<256thencopy((tn-224)*8,7*8)-(((tn-224)*8)+8,(7*8)+8),1to(c*8,f*8),0,tpset
13510nextc
13520nextf
13540_turbooff
13570return
13600ifmc=200-32thenreturn
13602_turboon(m(),mc)
13603fori=0+msto32+ms
13605mc=mc+1
13610copy(8,0)-(256,184),0to(0,0),0,pset
13620forf=3to23-1
13630tn=m(31+mc,f)
13640iftn>=0andtn<32thencopy(tn*8,0*8)-((tn*8)+8,(0*8)+8),1to(31*8,f*8),0
13650iftn>=32andtn<64thencopy((tn-32)*8,1*8)-(((tn-32)*8)+8,(1*8)+8),1to(31*8,f*8),0
13660iftn>=64andtn<96thencopy((tn-64)*8,2*8)-(((tn-64)*8)+8,(2*8)+8),1to(31*8,f*8),0
13670iftn>=96andtn<128thencopy((tn-96)*8,3*8)-(((tn-96)*8)+8,(3*8)+8),1to(31*8,f*8),0
13680iftn>=128andtn<160thencopy((tn-128)*8,4*8)-(((tn-128)*8)+8,(4*8)+8),1to(31*8,f*8),0
13690iftn>=160andtn<192thencopy((tn-160)*8,5*8)-(((tn-160)*8)+8,(5*8)+8),1to(31*8,f*8),0
13700iftn>=192andtn<224thencopy((tn-192)*8,6*8)-(((tn-192)*8)+8,(6*8)+8),1to(31*8,f*8),0
13710iftn>=224andtn<256thencopy((tn-224)*8,7*8)-(((tn-224)*8)+8,(7*8)+8),1to(31*8,f*8),0
13720nextf
13730nexti
13735_turbooff
13740return
13800ifms=0thenpreset(0,0):print#1,"mssindefinir"
13801ifms=1thengosub20200
13810ifms=2thengosub20300
13820ifms=3thengosub20400
13830ifms=4thengosub20500
13840ifms=5thengosub20600
13890return
    14000 cls:preset (10,30):  print #1,"@@@@  @  @@@@  @ @@@@@ @  @   @"
    14010 preset (10,40):      print #1,"@    @ @ @@@@  @   @  @ @ @ @ @"
    14020 preset (10,50):      print #1,"@@@@@   @@     @   @ @   @@  @@"
    14030 preset (10,70):      print #1,"10540,capita Kik, debes ir a recoger las muestras fabricadas en otros entornos planetarios."
    14040 preset (10,110):     print #1,"Pero ten cuidado los esbirros de worst que te obstaculizan."
    14050 preset (10,160): print #1, "Cursores para mover, pulsa una tecla para continuar"
    14060 preset (10,180): print #1, "libre: "fre(0)
14070ifinkey$=""thengoto14070
14090return
20000tf=160:te=26:tw=80
20010wc=6:wf=0
20090return
20100gosub12500:ex(en)=26*8:ey(en)=20*8
20190return
20200gosub12500:ex(en)=(17*8):ey(en)=17*8
20290return
20300gosub12500:ex(en)=20*8:ey(en)=20*8
20390return
20400gosub12500:ex(en)=16*8:ey(en)=10*8
20490return
20500gosub12500:ex(en)=26*8:ey(en)=20*8
20590return
20600gosub12500:ex(en)=15*8:ey(en)=14*8
20690return
